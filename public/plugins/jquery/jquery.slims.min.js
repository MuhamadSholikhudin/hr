
// In your Javascript (external .js resource or <script> tag)

var url = "http://10.10.40.190:8000/";

function Resign(){
    var resignnik = document.getElementById("resignnik").value;
    var resignktp = document.getElementById("resignktp").value;

    if(resignnik != "" && resignktp != ""){
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': jQuery('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "POST",
            url: url+'pages/apigetemployee',
            dataType: "json",
            data : {
                number_of_employees: resignnik,
                national_id: resignktp
            },
            success (status){
                if(status == 200){
                    var urlLocation = url+'pages/resign';
                    swal({
                        title: "Apakah anda yakin ingin resign ?",
                        text: "Jika anda yakin ingin mengajukan resign tekan OK dan jika anda tidak jadi tekan CANCEL !",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    })
                    .then((willDelete) => {
                        if (willDelete) {                   
                        window.location.assign(urlLocation);
                        } else {
                        swal("Permohonan resign tidak jadi !");
                        }
                    });
                    
                }else{
                    swal("Data Karyawan tidak di temukan !");
                }
            },error(){
                swal("Data Karyawan tidak di temukan !");
            }
        });
    }else{
        swal("NIK dan No KTP Tidak Boleh Kosong !!!");
    }
}

// Use Javascript
function today(){
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //January is 0 so need to add 1 to make it 1!
    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd
    }   
    if (mm < 10) {
        mm = '0' + mm
    }
    today = yyyy + '-' + mm + '-' + dd;
    return today;
}

function ShowFormResign(){
    $("#checkdisplay" ).show("slow");   
    $("#checkname").show("slow"); 
    $("#departmentxl").show("slow"); 
    $("#job_levelxl").show("slow"); 
}

function HideFormResign(){
    $("#checkdisplay").hide("slow");   
    $("#checkname").hide("slow");  
    $("#departmentxl").hide("slow"); 
    $("#job_levelxl").hide("slow"); 
}

function StatusForm(status){
    document.getElementById("dateresign").value = status[2];
    document.getElementById("dateresign").setAttribute("min", status[2]);
    document.getElementById("name").value = status[3];
    document.getElementById("job_level").value = status[5];
    document.getElementById("job_levelx").value = status[5];
    document.getElementById("department").value = status[6];
    document.getElementById("departmentx").value = status[6];
    if(status[0] == 200){
        document.getElementById("dateresign").disabled = false;
    }else{
        document.getElementById("dateresign").disabled = true;
    }
}

function OutputCheck(status){
    if(status[0] == 200){ // Belum Resign dan belum mengajukan resign pada table submissions
        ShowFormResign();  
        document.getElementById("status_employee").value = status[1];
        StatusForm(status);
        swal("Data Karyawan di temukan ! "+ status[4] + " !");
    }else if(status[0] == 202){ // Sudah Resign dan mengajukan resign sehingga boleh mengajukan resign
        ShowFormResign();  
        document.getElementById("status_employee").value = status[1];
        StatusForm(status);
        swal("Data Karyawan di temukan " + status[4] + " !");
    }else if(status[0] == 404){ // sudah mengajukan resign
        ShowFormResign(); 
        document.getElementById("status_employee").value = "";
        StatusForm(status);
        swal("Data Karyawan di temukan " + status[4] + " dan karyawan sudah mengajukan resign !");
    }else if(status[0] == 405){ // sudah resign dan sudah mengajukan permohonan resign 
        ShowFormResign();  
        document.getElementById("status_employee").value = "";
        StatusForm(status);
        swal("Data Karyawan di temukan " + status[4] + " Sudah mengajukan resign dan telah resign!");
    }else{ 
        HideFormResign();  
        document.getElementById("status_employee").value = "";
        swal("Data Karyawan tidak di temukan ! " , { className: "red-bg"});
    }
}

function Checkkeynik(){
    var resignnik = document.getElementById("resignnik").value;
    document.getElementById("valuenik").value = resignnik;
}

function Checkkeyktp(){
    var resignktp = document.getElementById("resignktp").value;
    document.getElementById("valuektp").value = resignktp;
}

function ResignCheck(){
    var resignnik = document.getElementById("resignnik").value;
    var resignktp = document.getElementById("resignktp").value;

    if(resignnik != "" && resignktp != ""){
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': jQuery('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "POST",
            url: url+'pages/apigetresign',
            dataType: "json",
            data : {
                number_of_employees: resignnik,
                national_id: resignktp
            },
            beforeSend: function() {
                $("#spinner").show();
            },
            success (status){              
                OutputCheck(status);
                $("#spinner").hide();                
            },error(){
                $("#spinner").hide();
                swal("ERROR!");
            }
        });
    }else{
        swal("NIK dan No KTP Tidak Boleh Kosong !!!");
    }
}



